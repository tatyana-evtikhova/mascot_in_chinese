{% extends "base.html" %}

{% block content %}
<div class="dashboard-container">
    <!-- Welcome Section -->
    <div class="notion-block welcome-block">
        <div class="welcome-header">
            <h1>Welcome back, {{ current_user.username }}! üëã</h1>
            <p class="last-active">Last active: {{ current_user.last_login.strftime('%B %d, %Y at %H:%M') }}</p>
        </div>
    </div>

    <!-- Quick Stats -->
    <div class="notion-block stats-block">
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon">üìö</div>
                <div class="stat-value">{{ completed_lessons }}</div>
                <div class="stat-label">Lessons Completed</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">üî•</div>
                <div class="stat-value">{{ streak_days }}</div>
                <div class="stat-label">Day Streak</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">‚è±Ô∏è</div>
                <div class="stat-value">{{ total_time|round }}</div>
                <div class="stat-label">Hours Studied</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">üéØ</div>
                <div class="stat-value">{{ progress_percentage|round }}%</div>
                <div class="stat-label">Overall Progress</div>
            </div>
        </div>
    </div>

    <!-- Main Content Grid -->
    <div class="dashboard-grid">
        <!-- Progress Chart -->
        <div class="notion-block">
            <div class="block-header">
                <h2>Learning Progress</h2>
                <div class="block-actions">
                    <button class="btn-icon" onclick="toggleView('chart')" title="Toggle view">
                        <i class="bi bi-graph-up"></i>
                    </button>
                </div>
            </div>
            <div class="block-content">
                <canvas id="progressChart" height="200"></canvas>
            </div>
        </div>

        <!-- Recent Activity -->
        <div class="notion-block">
            <div class="block-header">
                <h2>Recent Activity</h2>
                <div class="block-actions">
                    <button class="btn-icon" onclick="toggleView('activity')" title="Toggle view">
                        <i class="bi bi-clock-history"></i>
                    </button>
                </div>
            </div>
            <div class="block-content">
                <div class="activity-list">
                    {% for activity in recent_activities %}
                    <div class="activity-item">
                        <div class="activity-icon">
                            <i class="bi {{ activity.icon }}"></i>
                        </div>
                        <div class="activity-content">
                            <div class="activity-title">{{ activity.title }}</div>
                            <div class="activity-time">{{ activity.timestamp.strftime('%Y-%m-%d %H:%M') }}</div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>

        <!-- Achievements -->
        <div class="notion-block">
            <div class="block-header">
                <h2>Achievements</h2>
                <div class="block-actions">
                    <button class="btn-icon" onclick="toggleView('achievements')" title="Toggle view">
                        <i class="bi bi-trophy"></i>
                    </button>
                </div>
            </div>
            <div class="block-content">
                <div class="achievements-grid">
                    {% for achievement in achievements %}
                    <div class="achievement-card {{ 'unlocked' if achievement.unlocked }}">
                        <div class="achievement-icon">{{ achievement.icon }}</div>
                        <div class="achievement-info">
                            <div class="achievement-name">{{ achievement.name }}</div>
                            <div class="achievement-desc">{{ achievement.description }}</div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>

        <!-- Next Lessons -->
        <div class="notion-block">
            <div class="block-header">
                <h2>Next Up</h2>
                <div class="block-actions">
                    <button class="btn-icon" onclick="toggleView('lessons')" title="Toggle view">
                        <i class="bi bi-book"></i>
                    </button>
                </div>
            </div>
            <div class="block-content">
                <div class="next-lessons">
                    <!-- Add your next lessons content here -->
                    <a href="{{ url_for('lesson_map') }}" class="btn-notion">
                        <i class="bi bi-play-circle"></i> Continue Learning
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
:root {
    /* Notion Color Palette */
    --notion-bg: #ffffff;
    --notion-text: #37352f;
    --notion-gray: #9b9a97;
    --notion-bg-gray: #f7f6f3;
    --notion-bg-hover: #efefef;
    --notion-border: rgba(55, 53, 47, 0.09);
    --notion-shadow: rgba(15, 15, 15, 0.05);
}

.dashboard-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 2rem;
}

.notion-block {
    background: var(--notion-bg);
    border: 1px solid var(--notion-border);
    border-radius: 3px;
    margin-bottom: 1.5rem;
    transition: box-shadow 0.2s ease;
}

.notion-block:hover {
    box-shadow: 0 2px 6px var(--notion-shadow);
}

.welcome-block {
    padding: 2rem;
    margin-bottom: 2rem;
}

.welcome-header h1 {
    margin: 0;
    color: var(--notion-text);
    font-size: 2rem;
    font-weight: 600;
}

.last-active {
    color: var(--notion-gray);
    margin: 0.5rem 0 0;
}

.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1rem;
    padding: 1rem;
}

.stat-card {
    background: var(--notion-bg-gray);
    padding: 1.5rem;
    border-radius: 3px;
    text-align: center;
    transition: background 0.2s ease;
}

.stat-card:hover {
    background: var(--notion-bg-hover);
}

.stat-icon {
    font-size: 2rem;
    margin-bottom: 0.5rem;
}

.stat-value {
    font-size: 1.5rem;
    font-weight: 600;
    color: var(--notion-text);
    margin-bottom: 0.25rem;
}

.stat-label {
    color: var(--notion-gray);
    font-size: 0.9rem;
}

.dashboard-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
    gap: 1.5rem;
}

.block-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1rem 1.5rem;
    border-bottom: 1px solid var(--notion-border);
}

.block-header h2 {
    margin: 0;
    color: var(--notion-text);
    font-size: 1.1rem;
    font-weight: 500;
}

.block-content {
    padding: 1.5rem;
}

.btn-icon {
    background: transparent;
    border: none;
    padding: 0.5rem;
    color: var(--notion-gray);
    border-radius: 3px;
    cursor: pointer;
    transition: all 0.2s ease;
}

.btn-icon:hover {
    background: var(--notion-bg-hover);
    color: var(--notion-text);
}

.activity-list {
    display: flex;
    flex-direction: column;
    gap: 1rem;
}

.activity-item {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 0.75rem;
    border-radius: 3px;
    transition: background 0.2s ease;
}

.activity-item:hover {
    background: var(--notion-bg-gray);
}

.activity-icon {
    width: 32px;
    height: 32px;
    background: var(--notion-bg-gray);
    border-radius: 3px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.activity-content {
    flex: 1;
}

.activity-title {
    color: var(--notion-text);
    font-weight: 500;
}

.activity-time {
    color: var(--notion-gray);
    font-size: 0.8rem;
}

.achievements-grid {
    display: grid;
    gap: 1rem;
}

.achievement-card {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 1rem;
    background: var(--notion-bg-gray);
    border-radius: 3px;
    opacity: 0.5;
    transition: all 0.2s ease;
}

.achievement-card.unlocked {
    opacity: 1;
}

.achievement-card:hover {
    background: var(--notion-bg-hover);
}

.achievement-icon {
    font-size: 1.5rem;
}

.achievement-name {
    color: var(--notion-text);
    font-weight: 500;
}

.achievement-desc {
    color: var(--notion-gray);
    font-size: 0.9rem;
}

.btn-notion {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.5rem 1rem;
    background: var(--notion-bg-gray);
    border: 1px solid var(--notion-border);
    border-radius: 3px;
    color: var(--notion-text);
    text-decoration: none;
    font-size: 0.9rem;
    transition: all 0.2s ease;
}

.btn-notion:hover {
    background: var(--notion-bg-hover);
    text-decoration: none;
}

@media (max-width: 768px) {
    .dashboard-container {
        padding: 1rem;
    }

    .stats-grid {
        grid-template-columns: repeat(2, 1fr);
    }

    .dashboard-grid {
        grid-template-columns: 1fr;
    }
}
</style>

<script>
// Initialize progress chart
const ctx = document.getElementById('progressChart').getContext('2d');
const progressChart = new Chart(ctx, {
    type: 'line',
    data: {
        labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
        datasets: [{
            label: 'Study Time (minutes)',
            data: [30, 45, 60, 35, 50, 40, 55],
            borderColor: '#0f7b6c',
            tension: 0.4,
            fill: false
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
            legend: {
                display: false
            }
        },
        scales: {
            y: {
                beginAtZero: true,
                grid: {
                    color: 'rgba(0, 0, 0, 0.05)'
                }
            },
            x: {
                grid: {
                    display: false
                }
            }
        }
    }
});

function toggleView(section) {
    // Implement view toggling functionality
    console.log('Toggling view for:', section);
}
</script>
{% endblock %} 